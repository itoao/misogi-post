import{Logger as e,isEmpty as r}from"@aws-amplify/core";import{A as t,C as s,U as o}from"./p-417bb5ea.js";import{Auth as a,CognitoUser as n}from"@aws-amplify/auth";import{T as i}from"./p-26837fd8.js";import{N as c}from"./p-900152ca.js";import{a as f}from"./p-639f5cf6.js";const p=new e("auth-helpers");async function m(e,s){if(!a||"function"!=typeof a.verifiedContact)throw new Error(c);if(u(e))try{const o=await a.verifiedContact(e);if(!r(o.verified)||r(o.unverified))s(t.SignedIn,e);else{const r=Object.assign(e,o);s(t.VerifyContact,r)}}catch(o){f(o)}else s(t.SignedIn,e)}const w=async(e,r,n,w)=>{if(!a||"function"!=typeof a.signIn)throw new Error(c);try{const o=await a.signIn(e,r);p.debug(o),o.challengeName===s.SMSMFA||o.challengeName===s.SoftwareTokenMFA?(p.debug("confirm user with "+o.challengeName),n(t.ConfirmSignIn,o)):o.challengeName===s.NewPasswordRequired?(p.debug("require new password",o.challengeParam),n(t.ResetPassword,o)):o.challengeName===s.MFASetup?(p.debug("TOTP setup",o.challengeParam),n(t.TOTPSetup,o)):o.challengeName===s.CustomChallenge&&o.challengeParam&&"true"===o.challengeParam.trigger?(p.debug("custom challenge",o.challengeParam),n(t.CustomConfirmSignIn,o)):await m(o,n)}catch(u){"UserNotConfirmedException"===u.code?(p.debug("the user is not confirmed"),n(t.ConfirmSignUp,{username:e})):"PasswordResetRequiredException"===u.code?(p.debug("the user requires a new password"),n(t.ForgotPassword,{username:e})):"InvalidParameterException"===u.code&&""===r?(p.debug("Password cannot be empty"),u.message=i.EMPTY_PASSWORD):u.message===i.EMPTY_USERNAME&&(w===o.email&&(u.message=i.EMPTY_EMAIL),w===o.phone_number&&(u.message=i.EMPTY_PHONE)),f(u)}},u=e=>e instanceof n;export{m as c,w as h}